rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // ───── Verification Documents ─────
    // Documents uploaded by users during onboarding/verification.
    match /verification-documents/{userId}/{allPaths=**} {

      // Helper: check if the current user is an employee
      function isEmployee() {
        return get(/databases/(default)/documents/users/$(request.auth.uid)).data.userType == 'employee';
      }

      // Helper: check if the current user is the document owner (exporter or carrier)
      function isOwner() {
        return request.auth.uid == userId;
      }

      // READ: Owner or employee can read
      allow read: if request.auth != null && (isOwner() || isEmployee());

      // WRITE: Only the owner (exporter or carrier) can upload their own verification docs
      allow write: if request.auth != null && isOwner();
    }

    // ───── Default Deny Rule ─────
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
